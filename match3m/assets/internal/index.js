System.register("chunks:///internal.js",["./rollupPluginModLoBabelHelpers-8eb20a6f.js","cc"],(function(){var e,t,a,i,o,n,r,s,l,d,h,p,c,u,g,m,b,f,S,_,w,P,M,y,v,T,R,E,C;return{setters:[function(r){e=r._,t=r.a,a=r.b,i=r.c,o=r.d,n=r.e},function(e){r=e.cclegacy,s=e.gfx,l=e.ccenum,d=e._decorator,h=e.Camera,p=e.CCBoolean,c=e.CCInteger,u=e.CCFloat,g=e.Material,m=e.Texture2D,b=e.rendering,f=e.Component,S=e.geometry,_=e.renderer,w=e.assert,P=e.Layers,M=e.PipelineEventType,y=e.Vec2,v=e.Vec4,T=e.sys,R=e.pipeline,E=e.Vec3,C=e.clamp}],execute:function(){r._RF.push({},"cbf30kCUX9A3K+QpVC6wnzx","builtin-pipeline-types",void 0);var x=s.SampleCount;function A(){return{enabled:!1,sampleCount:x.X4}}var D,F,L,O,N,G,B,Q,z,H,I,k,W,U,V,j,K,X,Y,q,Z,J,$,ee,te,ae,ie,oe,ne,re,se,le,de,he=function(e){return e[e.KawaseDualFilter=0]="KawaseDualFilter",e[e.MipmapFilter=1]="MipmapFilter",e}({});function pe(){return{enabled:!1,type:he.KawaseDualFilter,material:null,kawaseFilterMaterial:null,mipmapFilterMaterial:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:1}}function ce(){return{msaa:A(),enableShadingScale:!1,shadingScale:.5,bloom:pe(),toneMapping:{material:null},colorGrading:{enabled:!1,material:null,contribute:1,colorGradingMap:null},fsr:{enabled:!1,material:null,sharpness:.8},fxaa:{enabled:!1,material:null}}}function ue(e){e.msaa?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.sampleCount&&(e.sampleCount=x.X4)}(e.msaa):e.msaa=A(),void 0===e.enableShadingScale&&(e.enableShadingScale=!1),void 0===e.shadingScale&&(e.shadingScale=.5),e.bloom?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.type&&(e.type=he.KawaseDualFilter),void 0===e.material&&(e.material=null),void 0===e.kawaseFilterMaterial&&(e.kawaseFilterMaterial=e.material||null),void 0===e.mipmapFilterMaterial&&(e.mipmapFilterMaterial=null),void 0===e.enableAlphaMask&&(e.enableAlphaMask=!1),void 0===e.iterations&&(e.iterations=3),void 0===e.threshold&&(e.threshold=.8),void 0===e.intensity&&(e.intensity=1)}(e.bloom):e.bloom=pe(),e.toneMapping?function(e){void 0===e.material&&(e.material=null)}(e.toneMapping):e.toneMapping={material:null},e.colorGrading?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.contribute&&(e.contribute=1),void 0===e.colorGradingMap&&(e.colorGradingMap=null)}(e.colorGrading):e.colorGrading={enabled:!1,material:null,contribute:1,colorGradingMap:null},e.fsr?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.sharpness&&(e.sharpness=.8)}(e.fsr):e.fsr={enabled:!1,material:null,sharpness:.8},e.fxaa?function(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null)}(e.fxaa):e.fxaa={enabled:!1,material:null}}l(he),r._RF.pop(),r._RF.push({},"de1c2EHcMhAIYRZY5nyTQHG","builtin-pipeline-settings",void 0);var ge=d.ccclass,me=d.disallowMultiple,be=d.executeInEditMode,fe=d.menu,Se=d.property,_e=d.requireComponent,we=d.type;D=ge("BuiltinPipelineSettings"),F=fe("Rendering/BuiltinPipelineSettings"),L=_e(h),O=Se(p),N=Se({displayName:"Editor Preview (Experimental)",type:p}),G=Se({group:{id:"MSAA",name:"Multisample Anti-Aliasing"},type:p}),B=Se({group:{id:"MSAA",name:"Multisample Anti-Aliasing",style:"section"},type:c,range:[2,4,2]}),Q=Se({group:{id:"ShadingScale",name:"ShadingScale",style:"section"},type:p}),z=Se({tooltip:"i18n:postprocess.shadingScale",group:{id:"ShadingScale",name:"ShadingScale"},type:u,range:[.01,4,.01],slide:!0}),H=Se({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:p}),I=we(he),k=Se({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"}}),W=Se({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:g}),U=Se({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:g}),V=Se({tooltip:"i18n:bloom.enableAlphaMask",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:p}),j=Se({tooltip:"i18n:bloom.iterations",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:c,range:[1,6,1],slide:!0}),K=Se({tooltip:"i18n:bloom.threshold",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:u,min:0}),X=we(u),Y=Se({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"}}),q=Se({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:p}),Z=Se({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:g}),J=Se({tooltip:"i18n:color_grading.contribute",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:u,range:[0,1,.01],slide:!0}),$=Se({tooltip:"i18n:color_grading.originalMap",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:m}),ee=Se({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:p}),te=Se({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:g}),ae=Se({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:p}),ie=Se({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:g}),oe=Se({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:u,range:[0,1,.01],slide:!0}),ne=Se({group:{id:"ToneMapping",name:"ToneMapping",style:"section"},type:g}),D(re=F(re=L(re=me(re=be((le=e((se=function(e){function n(){for(var t,o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return t=e.call.apply(e,[this].concat(n))||this,a(t,"_settings",le,i(t)),a(t,"_editorPreview",de,i(t)),t}t(n,e);var r=n.prototype;return r.getPipelineSettings=function(){return this._settings},r.onEnable=function(){ue(this._settings),this.getComponent(h).camera.pipelineSettings=this._settings},r.onDisable=function(){var e=this.getComponent(h).camera;e&&(e.pipelineSettings=null)},r._tryEnableEditorPreview=function(){void 0!==b&&(this._editorPreview?b.setEditorPipelineSettings(this._settings):this._disableEditorPreview())},r._disableEditorPreview=function(){void 0!==b&&(b.getEditorPipelineSettings()===this._settings&&b.setEditorPipelineSettings(null))},o(n,[{key:"editorPreview",get:function(){return this._editorPreview},set:function(e){this._editorPreview=e}},{key:"MsaaEnable",get:function(){return this._settings.msaa.enabled},set:function(e){this._settings.msaa.enabled=e}},{key:"msaaSampleCount",get:function(){return this._settings.msaa.sampleCount},set:function(e){e=Math.pow(2,Math.ceil(Math.log2(Math.max(e,2)))),e=Math.min(e,4),this._settings.msaa.sampleCount=e}},{key:"shadingScaleEnable",get:function(){return this._settings.enableShadingScale},set:function(e){this._settings.enableShadingScale=e}},{key:"shadingScale",get:function(){return this._settings.shadingScale},set:function(e){this._settings.shadingScale=e}},{key:"bloomEnable",get:function(){return this._settings.bloom.enabled},set:function(e){this._settings.bloom.enabled=e}},{key:"bloomType",get:function(){return this._settings.bloom.type},set:function(e){this._settings.bloom.type=e}},{key:"kawaseBloomMaterial",get:function(){return this._settings.bloom.kawaseFilterMaterial},set:function(e){this._settings.bloom.kawaseFilterMaterial!==e&&(this._settings.bloom.kawaseFilterMaterial=e)}},{key:"mipmapBloomMaterial",get:function(){return this._settings.bloom.mipmapFilterMaterial},set:function(e){this._settings.bloom.mipmapFilterMaterial!==e&&(this._settings.bloom.mipmapFilterMaterial=e)}},{key:"bloomEnableAlphaMask",get:function(){return this._settings.bloom.enableAlphaMask},set:function(e){this._settings.bloom.enableAlphaMask=e}},{key:"bloomIterations",get:function(){return this._settings.bloom.iterations},set:function(e){this._settings.bloom.iterations=e}},{key:"bloomThreshold",get:function(){return this._settings.bloom.threshold},set:function(e){this._settings.bloom.threshold=e}},{key:"bloomIntensity",get:function(){return this._settings.bloom.intensity},set:function(e){this._settings.bloom.intensity=e}},{key:"colorGradingEnable",get:function(){return this._settings.colorGrading.enabled},set:function(e){this._settings.colorGrading.enabled=e}},{key:"colorGradingMaterial",get:function(){return this._settings.colorGrading.material},set:function(e){this._settings.colorGrading.material!==e&&(this._settings.colorGrading.material=e)}},{key:"colorGradingContribute",get:function(){return this._settings.colorGrading.contribute},set:function(e){this._settings.colorGrading.contribute=e}},{key:"colorGradingMap",get:function(){return this._settings.colorGrading.colorGradingMap},set:function(e){this._settings.colorGrading.colorGradingMap=e}},{key:"fxaaEnable",get:function(){return this._settings.fxaa.enabled},set:function(e){this._settings.fxaa.enabled=e}},{key:"fxaaMaterial",get:function(){return this._settings.fxaa.material},set:function(e){this._settings.fxaa.material!==e&&(this._settings.fxaa.material=e)}},{key:"fsrEnable",get:function(){return this._settings.fsr.enabled},set:function(e){this._settings.fsr.enabled=e}},{key:"fsrMaterial",get:function(){return this._settings.fsr.material},set:function(e){this._settings.fsr.material!==e&&(this._settings.fsr.material=e)}},{key:"fsrSharpness",get:function(){return this._settings.fsr.sharpness},set:function(e){this._settings.fsr.sharpness=e}},{key:"toneMappingMaterial",get:function(){return this._settings.toneMapping.material},set:function(e){this._settings.toneMapping.material!==e&&(this._settings.toneMapping.material=e)}}]),n}(f)).prototype,"_settings",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ce()}}),de=e(se.prototype,"_editorPreview",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e(se.prototype,"editorPreview",[N],Object.getOwnPropertyDescriptor(se.prototype,"editorPreview"),se.prototype),e(se.prototype,"MsaaEnable",[G],Object.getOwnPropertyDescriptor(se.prototype,"MsaaEnable"),se.prototype),e(se.prototype,"msaaSampleCount",[B],Object.getOwnPropertyDescriptor(se.prototype,"msaaSampleCount"),se.prototype),e(se.prototype,"shadingScaleEnable",[Q],Object.getOwnPropertyDescriptor(se.prototype,"shadingScaleEnable"),se.prototype),e(se.prototype,"shadingScale",[z],Object.getOwnPropertyDescriptor(se.prototype,"shadingScale"),se.prototype),e(se.prototype,"bloomEnable",[H],Object.getOwnPropertyDescriptor(se.prototype,"bloomEnable"),se.prototype),e(se.prototype,"bloomType",[I,k],Object.getOwnPropertyDescriptor(se.prototype,"bloomType"),se.prototype),e(se.prototype,"kawaseBloomMaterial",[W],Object.getOwnPropertyDescriptor(se.prototype,"kawaseBloomMaterial"),se.prototype),e(se.prototype,"mipmapBloomMaterial",[U],Object.getOwnPropertyDescriptor(se.prototype,"mipmapBloomMaterial"),se.prototype),e(se.prototype,"bloomEnableAlphaMask",[V],Object.getOwnPropertyDescriptor(se.prototype,"bloomEnableAlphaMask"),se.prototype),e(se.prototype,"bloomIterations",[j],Object.getOwnPropertyDescriptor(se.prototype,"bloomIterations"),se.prototype),e(se.prototype,"bloomThreshold",[K],Object.getOwnPropertyDescriptor(se.prototype,"bloomThreshold"),se.prototype),e(se.prototype,"bloomIntensity",[X,Y],Object.getOwnPropertyDescriptor(se.prototype,"bloomIntensity"),se.prototype),e(se.prototype,"colorGradingEnable",[q],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingEnable"),se.prototype),e(se.prototype,"colorGradingMaterial",[Z],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingMaterial"),se.prototype),e(se.prototype,"colorGradingContribute",[J],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingContribute"),se.prototype),e(se.prototype,"colorGradingMap",[$],Object.getOwnPropertyDescriptor(se.prototype,"colorGradingMap"),se.prototype),e(se.prototype,"fxaaEnable",[ee],Object.getOwnPropertyDescriptor(se.prototype,"fxaaEnable"),se.prototype),e(se.prototype,"fxaaMaterial",[te],Object.getOwnPropertyDescriptor(se.prototype,"fxaaMaterial"),se.prototype),e(se.prototype,"fsrEnable",[ae],Object.getOwnPropertyDescriptor(se.prototype,"fsrEnable"),se.prototype),e(se.prototype,"fsrMaterial",[ie],Object.getOwnPropertyDescriptor(se.prototype,"fsrMaterial"),se.prototype),e(se.prototype,"fsrSharpness",[oe],Object.getOwnPropertyDescriptor(se.prototype,"fsrSharpness"),se.prototype),e(se.prototype,"toneMappingMaterial",[ne],Object.getOwnPropertyDescriptor(se.prototype,"toneMappingMaterial"),se.prototype),re=se))||re)||re)||re)||re);r._RF.pop(),r._RF.push({},"ff9b0GZzgRM/obMbHGfCNbk","builtin-pipeline",void 0);var Pe=S.AABB,Me=S.Sphere,ye=S.intersect,ve=s.ClearFlagBit,Te=s.Color,Re=s.Format,Ee=s.FormatFeatureBit,Ce=s.LoadOp,xe=s.StoreOp,Ae=s.TextureType,De=s.Viewport,Fe=_.scene,Le=Fe.CameraUsage,Oe=Fe.CSMLevel,Ne=Fe.LightType;function Ge(e){return!!(e.clearFlag&(ve.COLOR|ve.STENCIL<<1))}function Be(e,t,a,i,o,n){e.shadowFixedArea||e.csmLevel===Oe.LEVEL_1?(o.left=0,o.top=0,o.width=Math.trunc(t),o.height=Math.trunc(a)):(o.left=Math.trunc(i%2*.5*t),o.top=n>0?Math.trunc(.5*(1-Math.floor(i/2))*a):Math.trunc(.5*Math.floor(i/2)*a),o.width=Math.trunc(.5*t),o.height=Math.trunc(.5*a)),o.left=Math.max(0,o.left),o.top=Math.max(0,o.top),o.width=Math.max(1,o.width),o.height=Math.max(1,o.height)}var Qe=function(){this.isWeb=!1,this.isWebGL1=!1,this.isWebGPU=!1,this.isMobile=!1,this.isHDR=!1,this.useFloatOutput=!1,this.toneMappingType=0,this.shadowEnabled=!1,this.shadowMapFormat=Re.R32F,this.shadowMapSize=new y(1,1),this.usePlanarShadow=!1,this.screenSpaceSignY=1,this.supportDepthSample=!1,this.mobileMaxSpotLightShadowMaps=1,this.platform=new v(0,0,0,0)};function ze(e,t){var a=Ee.SAMPLED_TEXTURE|Ee.LINEAR_FILTER,i=e.device;t.isWeb=!T.isNative,t.isWebGL1=i.gfxAPI===s.API.WEBGL,t.isWebGPU=i.gfxAPI===s.API.WEBGPU,t.isMobile=T.isMobile,t.isHDR=e.pipelineSceneData.isHDR,t.useFloatOutput=e.getMacroBool("CC_USE_FLOAT_OUTPUT"),t.toneMappingType=e.pipelineSceneData.postSettings.toneMappingType;var o=e.pipelineSceneData.shadows;t.shadowEnabled=o.enabled,t.shadowMapFormat=R.supportsR32FloatTexture(e.device)?Re.R32F:Re.RGBA8,t.shadowMapSize.set(o.size),t.usePlanarShadow=o.enabled&&o.type===_.scene.ShadowType.Planar,t.screenSpaceSignY=e.device.capabilities.screenSpaceSignY,t.supportDepthSample=(e.device.getFormatFeatures(Re.DEPTH_STENCIL)&a)===a;var n=i.capabilities.screenSpaceSignY;t.platform.x=t.isMobile?1:0,t.platform.w=.5*n+.5<<1|.5*i.capabilities.clipSpaceSignY+.5}var He=ce(),Ie=function(){this.settings=He,this.isMainGameWindow=!1,this.renderWindowId=0,this.colorName="",this.depthStencilName="",this.enableFullPipeline=!1,this.enableProfiler=!1,this.remainingPasses=0,this.enableShadingScale=!1,this.shadingScale=1,this.nativeWidth=1,this.nativeHeight=1,this.width=1,this.height=1,this.enableHDR=!1,this.radianceFormat=s.Format.RGBA8,this.copyAndTonemapMaterial=null,this.enableStoreSceneDepth=!1},ke=new Te(0,0,0,0);function We(e,t,a,i){w(!!a.copyAndTonemapMaterial);var o=e.addRenderPass(a.nativeWidth,a.nativeHeight,"cc-tone-mapping");return o.addRenderTarget(a.colorName,Ce.CLEAR,xe.STORE,ke),o.addTexture(i,"inputTexture"),o.addQueue(b.QueueHint.OPAQUE).addFullscreenQuad(a.copyAndTonemapMaterial,1),o}function Ue(e,t,a){return e.startsWith(t)?""+t+(1-Number(e.charAt(t.length)))+"_"+a:t+"0_"+a}var Ve=function(){function e(){this.lights=[],this.shadowEnabledSpotLights=[],this._sphere=Me.create(0,0,0,1),this._boundingBox=new Pe,this._rangedDirLightBoundingBox=new Pe(0,0,0,.5,.5,.5)}var t=e.prototype;return t.cullLights=function(e,t,a){this.lights.length=0,this.shadowEnabledSpotLights.length=0;for(var i,o=n(e.spotLights);!(i=o()).done;){var r=i.value;r.baked||(Me.set(this._sphere,r.position.x,r.position.y,r.position.z,r.range),ye.sphereFrustum(this._sphere,t)&&(r.shadowEnabled?this.shadowEnabledSpotLights.push(r):this.lights.push(r)))}for(var s,l=n(e.sphereLights);!(s=l()).done;){var d=s.value;d.baked||(Me.set(this._sphere,d.position.x,d.position.y,d.position.z,d.range),ye.sphereFrustum(this._sphere,t)&&this.lights.push(d))}for(var h,p=n(e.pointLights);!(h=p()).done;){var c=h.value;c.baked||(Me.set(this._sphere,c.position.x,c.position.y,c.position.z,c.range),ye.sphereFrustum(this._sphere,t)&&this.lights.push(c))}for(var u,g=n(e.rangedDirLights);!(u=g()).done;){var m=u.value;Pe.transform(this._boundingBox,this._rangedDirLightBoundingBox,m.node.getWorldMatrix()),ye.aabbFrustum(this._boundingBox,t)&&this.lights.push(m)}a&&this.shadowEnabledSpotLights.sort((function(e,t){return E.squaredDistance(a,e.position)-E.squaredDistance(a,t.position)}))},t._addLightQueues=function(e,t){for(var a,i=n(this.lights);!(a=i()).done;){var o=a.value,r=t.addQueue(b.QueueHint.BLEND,"forward-add");switch(o.type){case Ne.SPHERE:r.name="sphere-light";break;case Ne.SPOT:r.name="spot-light";break;case Ne.POINT:r.name="point-light";break;case Ne.RANGED_DIRECTIONAL:r.name="ranged-directional-light";break;default:r.name="unknown-light"}r.addScene(e,b.SceneFlags.BLEND,o)}},t.addSpotlightShadowPasses=function(e,t,a){for(var i,o=0,r=n(this.shadowEnabledSpotLights);!(i=r()).done;){var s=i.value,l=e.pipelineSceneData.shadows.size,d=e.addRenderPass(l.x,l.y,"default");if(d.name="SpotLightShadowPass"+o,d.addRenderTarget("SpotShadowMap"+o,Ce.CLEAR,xe.STORE,new Te(1,1,1,1)),d.addDepthStencil("SpotShadowDepth"+o,Ce.CLEAR,xe.DISCARD),d.addQueue(b.QueueHint.NONE,"shadow-caster").addScene(t,b.SceneFlags.OPAQUE|b.SceneFlags.MASK|b.SceneFlags.SHADOW_CASTER).useLightFrustum(s),++o>=a)break}},t.addLightQueues=function(e,t,a){this._addLightQueues(t,e);for(var i,o=0,r=n(this.shadowEnabledSpotLights);!(i=r()).done;){var s=i.value;if(e.addTexture("SpotShadowMap"+o,"cc_spotShadowMap"),e.addQueue(b.QueueHint.BLEND,"forward-add").addScene(t,b.SceneFlags.BLEND,s),++o>=a)break}},t.addLightPasses=function(e,t,a,i,o,r,s,l,d,h){this._addLightQueues(s,h);for(var p,c=0,u=d.pipelineSceneData.shadows.size,g=n(this.shadowEnabledSpotLights);!(p=g()).done;){var m=p.value,f=d.addRenderPass(u.x,u.y,"default");f.name="SpotlightShadowPass",f.addRenderTarget("ShadowMap"+i,Ce.CLEAR,xe.STORE,new Te(1,1,1,1)),f.addDepthStencil("ShadowDepth"+i,Ce.CLEAR,xe.DISCARD),f.addQueue(b.QueueHint.NONE,"shadow-caster").addScene(s,b.SceneFlags.OPAQUE|b.SceneFlags.MASK|b.SceneFlags.SHADOW_CASTER).useLightFrustum(m);var S=++c===this.shadowEnabledSpotLights.length?a:xe.STORE;(h=d.addRenderPass(o,r,"default")).name="SpotlightWithShadowMap",h.setViewport(l),h.addRenderTarget(e,Ce.LOAD),h.addDepthStencil(t,Ce.LOAD,S),h.addTexture("ShadowMap"+i,"cc_spotShadowMap"),h.addQueue(b.QueueHint.BLEND,"forward-add").addScene(s,b.SceneFlags.BLEND,m)}return h},t.isMultipleLightPassesNeeded=function(){return this.shadowEnabledSpotLights.length>0},e}(),je=function(){function e(){this.forwardLighting=new Ve,this._viewport=new De,this._clearColor=new Te(0,0,0,1),this._reflectionProbeClearColor=new E(0,0,0)}var t=e.prototype;return t.getConfigOrder=function(){return e.ConfigOrder},t.getRenderOrder=function(){return e.RenderOrder},t.configCamera=function(e,t,a){a.enableMainLightShadowMap=t.shadowEnabled&&!t.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,a.enableMainLightPlanarShadowMap=t.shadowEnabled&&t.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,a.enablePlanarReflectionProbe=a.isMainGameWindow||e.cameraUsage===Le.SCENE_VIEW||e.cameraUsage===Le.GAME_VIEW,a.enableMSAA=a.settings.msaa.enabled&&!a.enableStoreSceneDepth&&!t.isWeb&&!t.isWebGL1,a.enableSingleForwardPass=t.isMobile||a.enableMSAA,++a.remainingPasses},t.windowResize=function(e,t,a,i,o,n,r){var s=b.ResourceFlags,l=b.ResourceResidency,d=i.renderWindowId,h=a.settings,p=a.enableShadingScale?Math.max(Math.floor(n*a.shadingScale),1):n,c=a.enableShadingScale?Math.max(Math.floor(r*a.shadingScale),1):r;if(a.enableMSAA&&(a.enableHDR?e.addTexture("MsaaRadiance"+d,Ae.TEX2D,a.radianceFormat,p,c,1,1,1,h.msaa.sampleCount,s.COLOR_ATTACHMENT,l.MEMORYLESS):e.addTexture("MsaaRadiance"+d,Ae.TEX2D,Re.RGBA8,p,c,1,1,1,h.msaa.sampleCount,s.COLOR_ATTACHMENT,l.MEMORYLESS),e.addTexture("MsaaDepthStencil"+d,Ae.TEX2D,Re.DEPTH_STENCIL,p,c,1,1,1,h.msaa.sampleCount,s.DEPTH_STENCIL_ATTACHMENT,l.MEMORYLESS)),e.addRenderTarget("ShadowMap"+d,t.shadowMapFormat,t.shadowMapSize.x,t.shadowMapSize.y),e.addDepthStencil("ShadowDepth"+d,Re.DEPTH_STENCIL,t.shadowMapSize.x,t.shadowMapSize.y),a.enableSingleForwardPass)for(var u=t.mobileMaxSpotLightShadowMaps,g=0;g!==u;++g)e.addRenderTarget("SpotShadowMap"+g,t.shadowMapFormat,t.shadowMapSize.x,t.shadowMapSize.y),e.addDepthStencil("SpotShadowDepth"+g,Re.DEPTH_STENCIL,t.shadowMapSize.x,t.shadowMapSize.y)},t.setup=function(e,t,a,i,o){e.setVec4("g_platform",t.platform);var n=i.window.renderWindowId,r=i.scene,s=r.mainLight;--a.remainingPasses,w(a.remainingPasses>=0),this.forwardLighting.cullLights(r,i.frustum),a.enableMainLightShadowMap&&(w(!!s),this._addCascadedShadowMapPass(e,t,n,s,i)),a.enableSingleForwardPass&&this.forwardLighting.addSpotlightShadowPasses(e,i,t.mobileMaxSpotLightShadowMaps),this._tryAddReflectionProbePasses(e,a,n,s,i.scene),a.remainingPasses>0||a.enableShadingScale?(o.colorName=a.enableShadingScale?"ScaledRadiance0_"+n:"Radiance0_"+n,o.depthStencilName=a.enableShadingScale?"ScaledSceneDepth_"+n:"SceneDepth_"+n):(o.colorName=a.colorName,o.depthStencilName=a.depthStencilName);var l=this._addForwardRadiancePasses(e,t,a,n,i,a.width,a.height,s,o.colorName,o.depthStencilName,!a.enableMSAA,a.enableStoreSceneDepth?xe.STORE:xe.DISCARD);return a.enableStoreSceneDepth||(o.depthStencilName=""),0===a.remainingPasses&&a.enableShadingScale?We(e,0,a,o.colorName):l},t._addCascadedShadowMapPass=function(e,t,a,i,o){var n=b.QueueHint,r=b.SceneFlags,s=e.pipelineSceneData.shadows.size,l=s.x,d=s.y,h=this._viewport;h.left=h.top=0,h.width=l,h.height=d;var p=e.addRenderPass(l,d,"default");p.name="CascadedShadowMap",p.addRenderTarget("ShadowMap"+a,Ce.CLEAR,xe.STORE,new Te(1,1,1,1)),p.addDepthStencil("ShadowDepth"+a,Ce.CLEAR,xe.DISCARD);for(var c=e.pipelineSceneData.csmSupported?i.csmLevel:1,u=0;u!==c;++u){Be(i,l,d,u,this._viewport,t.screenSpaceSignY);var g=p.addQueue(n.NONE,"shadow-caster");t.isWebGPU||g.setViewport(this._viewport),g.addScene(o,r.OPAQUE|r.MASK|r.SHADOW_CASTER).useLightFrustum(i,u)}},t._tryAddReflectionProbePasses=function(e,t,a,i,o){var l=r.internal.reflectionProbeManager;if(l)for(var d,h=b.ResourceResidency,p=l.getProbes(),c=0,u=n(p);!(d=u()).done;){var g=d.value;if(g.needRender){var m=g.renderArea(),f=Math.max(Math.floor(m.x),1),S=Math.max(Math.floor(m.y),1);if(g.probeType===_.scene.ProbeType.PLANAR){if(!t.enablePlanarReflectionProbe)continue;var w=g.realtimePlanarTexture.window,P="PlanarProbeRT"+c,M="PlanarProbeDS"+c;e.addRenderWindow(P,t.radianceFormat,f,S,w),e.addDepthStencil(M,s.Format.DEPTH_STENCIL,f,S,h.MEMORYLESS);var y=e.addRenderPass(f,S,"default");y.name="PlanarReflectionProbe"+c,this._buildReflectionProbePass(y,t,a,g.camera,P,M,i,o)}if(4===++c)break}}},t._buildReflectionProbePass=function(e,t,a,i,o,n,r,s){void 0===s&&(s=null);var l=b.QueueHint,d=b.SceneFlags,h=t.enableMSAA?xe.DISCARD:xe.STORE;if(Ge(i)){this._reflectionProbeClearColor.x=i.clearColor.x,this._reflectionProbeClearColor.y=i.clearColor.y,this._reflectionProbeClearColor.z=i.clearColor.z;var p=b.packRGBE(this._reflectionProbeClearColor);this._clearColor.x=p.x,this._clearColor.y=p.y,this._clearColor.z=p.z,this._clearColor.w=p.w,e.addRenderTarget(o,Ce.CLEAR,h,this._clearColor)}else e.addRenderTarget(o,Ce.LOAD,h);i.clearFlag&ve.DEPTH_STENCIL?e.addDepthStencil(n,Ce.CLEAR,xe.DISCARD,i.clearDepth,i.clearStencil,i.clearFlag&ve.DEPTH_STENCIL):e.addDepthStencil(n,Ce.LOAD,xe.DISCARD),t.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(l.NONE,"reflect-map").addScene(i,d.OPAQUE|d.MASK|d.REFLECTION_PROBE,r||void 0,s||void 0)},t._addForwardRadiancePasses=function(e,t,a,i,o,n,r,s,l,d,h,p){void 0===h&&(h=!1),void 0===p&&(p=xe.DISCARD);var c=b.QueueHint,u=b.SceneFlags,g=o.clearColor;this._clearColor.x=g.x,this._clearColor.y=g.y,this._clearColor.z=g.z,this._clearColor.w=g.w;var m=o.viewport;this._viewport.left=Math.round(m.x*n),this._viewport.top=Math.round(m.y*r),this._viewport.width=Math.max(Math.round(m.width*n),1),this._viewport.height=Math.max(Math.round(m.height*r),1);var f=!h&&a.enableMSAA;w(!f||a.enableSingleForwardPass);var S=a.enableSingleForwardPass?this._addForwardSingleRadiancePass(e,t,a,i,o,f,n,r,s,l,d,p):this._addForwardMultipleRadiancePasses(e,a,i,o,n,r,s,l,d,p);a.enableMainLightPlanarShadowMap&&this._addPlanarShadowQueue(o,s,S);var _=u.BLEND|(o.geometryRenderer?u.GEOMETRY:u.NONE);return S.addQueue(c.BLEND).addScene(o,_,s||void 0),S},t._addForwardSingleRadiancePass=function(e,t,a,i,o,n,r,s,l,d,h,p){var c;if(w(a.enableSingleForwardPass),n){var u="MsaaRadiance"+i,g="MsaaDepthStencil"+i,m=a.settings.msaa.sampleCount,b=e.addMultisampleRenderPass(r,s,m,0,"default");b.name="MsaaForwardPass",this._buildForwardMainLightPass(b,a,i,o,u,g,xe.DISCARD,l),b.resolveRenderTarget(u,d),c=b}else(c=e.addRenderPass(r,s,"default")).name="ForwardPass",this._buildForwardMainLightPass(c,a,i,o,d,h,p,l);return w(void 0!==c),this.forwardLighting.addLightQueues(c,o,t.mobileMaxSpotLightShadowMaps),c},t._addForwardMultipleRadiancePasses=function(e,t,a,i,o,n,r,s,l,d){w(!t.enableSingleForwardPass);var h=e.addRenderPass(o,n,"default");h.name="ForwardPass";var p=this.forwardLighting.isMultipleLightPassesNeeded()?xe.STORE:d;return this._buildForwardMainLightPass(h,t,a,i,s,l,p,r),h=this.forwardLighting.addLightPasses(s,l,d,a,o,n,i,this._viewport,e,h)},t._buildForwardMainLightPass=function(e,t,a,i,o,n,r,s,l){void 0===l&&(l=null);var d=b.QueueHint,h=b.SceneFlags;e.setViewport(this._viewport);var p=t.enableMSAA?xe.DISCARD:xe.STORE;Ge(i)?e.addRenderTarget(o,Ce.CLEAR,p,this._clearColor):e.addRenderTarget(o,Ce.LOAD,p),i.clearFlag&ve.DEPTH_STENCIL?e.addDepthStencil(n,Ce.CLEAR,r,i.clearDepth,i.clearStencil,i.clearFlag&ve.DEPTH_STENCIL):e.addDepthStencil(n,Ce.LOAD,r),t.enableMainLightShadowMap&&e.addTexture("ShadowMap"+a,"cc_shadowMap"),e.addQueue(d.NONE).addScene(i,h.OPAQUE|h.MASK,s||void 0,l||void 0)},t._addPlanarShadowQueue=function(e,t,a){var i=b.QueueHint,o=b.SceneFlags;a.addQueue(i.BLEND,"planar-shadow").addScene(e,o.SHADOW_CASTER|o.PLANAR_SHADOW|o.BLEND,t||void 0)},e}();function Ke(e,t){return Math.max(Math.floor(e*t),1)}je.ConfigOrder=100,je.RenderOrder=100;var Xe=function(){function e(){this._clearColorTransparentBlack=new Te(0,0,0,0),this._bloomParams=new v(0,0,0,0),this._bloomTexSize=new v(0,0,0,0),this._bloomWidths=[],this._bloomHeights=[],this._bloomTexNames=[],this._bloomUpSampleTexDescs=[],this._bloomDownSampleTexDescs=[],this._prefilterTexDesc={name:"",width:0,height:0},this._originalColorDesc={name:"",width:0,height:0}}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 200},t.configCamera=function(e,t,a){var i=a.settings.bloom,o=i.type===he.KawaseDualFilter&&!!i.kawaseFilterMaterial||i.type===he.MipmapFilter&&!!i.mipmapFilterMaterial;a.enableBloom=i.enabled&&o,a.enableBloom&&++a.remainingPasses},t.windowResize=function(e,t,a,i){if(a.enableBloom){var o=a.width,n=a.height,r=a.settings.bloom,s=i.renderWindowId,l=a.radianceFormat;if(r.type===he.KawaseDualFilter)for(var d=a.width,h=a.height,p=0;p!==r.iterations+1;++p)d=Math.max(Math.floor(d/2),1),h=Math.max(Math.floor(h/2),1),e.addRenderTarget("BloomTex"+s+"_"+p,l,d,h);else if(r.type===he.MipmapFilter){for(var c=r.iterations,u=0;u!==c+1;++u){if(u<c){var g=Math.pow(.5,u+2);this._bloomDownSampleTexDescs[u]=this.createTexture(e,"DownSampleColor"+s+u,Ke(o,g),Ke(n,g),l)}if(u<c-1){var m=Math.pow(.5,c-u-1);this._bloomUpSampleTexDescs[u]=this.createTexture(e,"UpSampleColor"+s+u,Ke(o,m),Ke(n,m),l)}}this._originalColorDesc=this.createTexture(e,"OriginalColor"+s,o,n,l),this._prefilterTexDesc=this.createTexture(e,"PrefilterColor"+s,Ke(o,.5),Ke(n,.5),l)}}},t.createTexture=function(e,t,a,i,o){var n={name:t,width:a,height:i};return e.addRenderTarget(n.name,o,n.width,n.height),n},t.setup=function(e,t,a,i,o,n){if(!a.enableBloom)return n;--a.remainingPasses,w(a.remainingPasses>=0);var r=a.settings.bloom,s=i.window.renderWindowId;switch(r.type){case he.KawaseDualFilter:var l=r.kawaseFilterMaterial;return w(!!l),this._addKawaseDualFilterBloomPasses(e,t,a,a.settings,l,s,a.width,a.height,o.colorName);case he.MipmapFilter:var d=r.mipmapFilterMaterial;return w(!!d),this._addMipmapFilterBloomPasses(e,t,a,a.settings,d,s,a.width,a.height,o.colorName);default:return n}},t._addKawaseDualFilterBloomPasses=function(e,t,a,i,o,n,r,s,l){var d=b.QueueHint,h=i.bloom.iterations,p=h+1;this._bloomWidths.length=p,this._bloomHeights.length=p,this._bloomWidths[0]=Math.max(Math.floor(r/2),1),this._bloomHeights[0]=Math.max(Math.floor(s/2),1);for(var c=1;c!==p;++c)this._bloomWidths[c]=Math.max(Math.floor(this._bloomWidths[c-1]/2),1),this._bloomHeights[c]=Math.max(Math.floor(this._bloomHeights[c-1]/2),1);this._bloomTexNames.length=p;for(var u=0;u!==p;++u)this._bloomTexNames[u]="BloomTex"+n+"_"+u;this._bloomParams.x=t.useFloatOutput?1:0,this._bloomParams.y=0,this._bloomParams.z=i.bloom.threshold,this._bloomParams.w=i.bloom.enableAlphaMask?1:0;var g=e.addRenderPass(this._bloomWidths[0],this._bloomHeights[0],"cc-bloom-prefilter");g.addRenderTarget(this._bloomTexNames[0],Ce.CLEAR,xe.STORE,this._clearColorTransparentBlack),g.addTexture(l,"inputTexture"),g.setVec4("bloomParams",this._bloomParams),g.addQueue(d.OPAQUE).addFullscreenQuad(o,0);for(var m=1;m!==p;++m){var f=e.addRenderPass(this._bloomWidths[m],this._bloomHeights[m],"cc-bloom-downsample");f.addRenderTarget(this._bloomTexNames[m],Ce.CLEAR,xe.STORE,this._clearColorTransparentBlack),f.addTexture(this._bloomTexNames[m-1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[m-1],this._bloomTexSize.y=this._bloomHeights[m-1],f.setVec4("bloomTexSize",this._bloomTexSize),f.addQueue(d.OPAQUE).addFullscreenQuad(o,1)}for(var S=h;S-- >0;){var _=e.addRenderPass(this._bloomWidths[S],this._bloomHeights[S],"cc-bloom-upsample");_.addRenderTarget(this._bloomTexNames[S],Ce.CLEAR,xe.STORE,this._clearColorTransparentBlack),_.addTexture(this._bloomTexNames[S+1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[S+1],this._bloomTexSize.y=this._bloomHeights[S+1],_.setVec4("bloomTexSize",this._bloomTexSize),_.addQueue(d.OPAQUE).addFullscreenQuad(o,2)}this._bloomParams.w=i.bloom.intensity;var w=e.addRenderPass(r,s,"cc-bloom-combine");return w.addRenderTarget(l,Ce.LOAD,xe.STORE),w.addTexture(this._bloomTexNames[0],"bloomTexture"),w.setVec4("bloomParams",this._bloomParams),w.addQueue(d.BLEND).addFullscreenQuad(o,3),0===a.remainingPasses?We(e,0,a,l):w},t._addPass=function(e,t,a,i,o,n,r,s,l,d){void 0===s&&(s=Ce.CLEAR),void 0===l&&(l=ke),void 0===d&&(d=b.QueueHint.OPAQUE);var h=e.addRenderPass(t,a,i);return h.addRenderTarget(o,s,xe.STORE,l),h.addQueue(d).addFullscreenQuad(n,r),h},t._addMipmapFilterBloomPasses=function(e,t,a,i,o,n,r,s,l){this._bloomParams.x=t.useFloatOutput?1:0,this._bloomParams.x=0,this._bloomParams.z=i.bloom.threshold,this._bloomParams.w=i.bloom.intensity;var d=this._prefilterTexDesc,h=this._addPass(e,d.width,d.height,"cc-bloom-mipmap-prefilter",d.name,o,0);h.addTexture(l,"mainTexture"),h.setVec4("bloomParams",this._bloomParams);for(var p=this._bloomDownSampleTexDescs,c=0;c<p.length;++c){var u=p[c],g=0===c?d:p[c-1],m=g.name;this._bloomTexSize.x=1/g.width,this._bloomTexSize.y=1/g.height,(h=this._addPass(e,u.width,u.height,"cc-bloom-mipmap-downsample",u.name,o,1)).addTexture(m,"mainTexture"),h.setVec4("bloomParams",this._bloomTexSize)}for(var b=p.length-1,f=this._bloomUpSampleTexDescs,S=0;S<f.length;S++){var _=f[S],w=0===S?p[b]:f[S-1],P=w.name;this._bloomTexSize.x=1/w.width,this._bloomTexSize.y=1/w.height,(h=this._addPass(e,_.width,_.height,"cc-bloom-mipmap-upsample",_.name,o,2)).addTexture(P,"mainTexture"),h.addTexture(p[b-1-S].name,"downsampleTexture"),h.setVec4("bloomParams",this._bloomTexSize)}var M=this._addPass(e,r,s,"cc-bloom-mipmap-combine",l,o,3,Ce.LOAD);return M.addTexture(f[f.length-1].name,"bloomTexture"),M.setVec4("bloomParams",this._bloomParams),0===a.remainingPasses?We(e,0,a,l):M},e}(),Ye=function(){function e(){this._colorGradingTexSize=new y(0,0)}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 300},t.configCamera=function(e,t,a){var i=a.settings;a.enableColorGrading=i.colorGrading.enabled&&!!i.colorGrading.material&&!!i.colorGrading.colorGradingMap,a.enableToneMapping=a.enableHDR||a.enableColorGrading,a.enableToneMapping&&++a.remainingPasses},t.windowResize=function(e,t,a){a.enableColorGrading&&(w(!!a.settings.colorGrading.material),a.settings.colorGrading.material.setProperty("colorGradingMap",a.settings.colorGrading.colorGradingMap))},t.setup=function(e,t,a,i,o,n){if(!a.enableToneMapping)return n;if(--a.remainingPasses,w(a.remainingPasses>=0),0===a.remainingPasses)return this._addCopyAndTonemapPass(e,t,a,a.width,a.height,o.colorName,a.colorName);var r=a.renderWindowId,s=a.enableShadingScale?"ScaledLdrColor":"LdrColor",l=Ue(o.colorName,s,r),d=o.colorName;return o.colorName=l,this._addCopyAndTonemapPass(e,t,a,a.width,a.height,d,l)},t._addCopyAndTonemapPass=function(e,t,a,i,o,n,r){var s,l=a.settings;if(a.enableColorGrading){w(!!l.colorGrading.material),w(!!l.colorGrading.colorGradingMap);var d=l.colorGrading.colorGradingMap;this._colorGradingTexSize.x=d.width,this._colorGradingTexSize.y=d.height;var h=d.width===d.height;(s=h?e.addRenderPass(i,o,"cc-color-grading-8x8"):e.addRenderPass(i,o,"cc-color-grading-nx1")).addRenderTarget(r,Ce.CLEAR,xe.STORE,ke),s.addTexture(n,"sceneColorMap"),s.setVec2("lutTextureSize",this._colorGradingTexSize),s.setFloat("contribute",l.colorGrading.contribute),s.addQueue(b.QueueHint.OPAQUE).addFullscreenQuad(l.colorGrading.material,h?1:0)}else(s=e.addRenderPass(i,o,"cc-tone-mapping")).addRenderTarget(r,Ce.CLEAR,xe.STORE,ke),s.addTexture(n,"inputTexture"),l.toneMapping.material?s.addQueue(b.QueueHint.OPAQUE).addFullscreenQuad(l.toneMapping.material,0):(w(!!a.copyAndTonemapMaterial),s.addQueue(b.QueueHint.OPAQUE).addFullscreenQuad(a.copyAndTonemapMaterial,0));return s},e}(),qe=function(){function e(){this._fxaaParams=new v(0,0,0,0)}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 400},t.configCamera=function(e,t,a){a.enableFXAA=a.settings.fxaa.enabled&&!!a.settings.fxaa.material,a.enableFXAA&&++a.remainingPasses},t.setup=function(e,t,a,i,o,n){if(!a.enableFXAA)return n;--a.remainingPasses,w(a.remainingPasses>=0);var r=a.renderWindowId,s=a.enableShadingScale?"ScaledLdrColor":"LdrColor",l=Ue(o.colorName,s,r);if(w(!!a.settings.fxaa.material),0===a.remainingPasses)return a.enableShadingScale?(this._addFxaaPass(e,t,a.settings.fxaa.material,a.width,a.height,o.colorName,l),We(e,0,a,l)):(w(a.width===a.nativeWidth),w(a.height===a.nativeHeight),this._addFxaaPass(e,t,a.settings.fxaa.material,a.width,a.height,o.colorName,a.colorName));var d=o.colorName;return o.colorName=l,this._addFxaaPass(e,t,a.settings.fxaa.material,a.width,a.height,d,l)},t._addFxaaPass=function(e,t,a,i,o,n,r){this._fxaaParams.x=i,this._fxaaParams.y=o,this._fxaaParams.z=1/i,this._fxaaParams.w=1/o;var s=e.addRenderPass(i,o,"cc-fxaa");return s.addRenderTarget(r,Ce.CLEAR,xe.STORE,ke),s.addTexture(n,"sceneColorMap"),s.setVec4("texSize",this._fxaaParams),s.addQueue(b.QueueHint.OPAQUE).addFullscreenQuad(a,0),s},e}(),Ze=function(){function e(){this._fsrParams=new v(0,0,0,0),this._fsrTexSize=new v(0,0,0,0)}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 500},t.configCamera=function(e,t,a){a.enableFSR=a.settings.fsr.enabled&&!!a.settings.fsr.material&&a.enableShadingScale&&a.shadingScale<1,a.enableFSR&&++a.remainingPasses},t.setup=function(e,t,a,i,o,n){if(!a.enableFSR)return n;--a.remainingPasses;var r=o.colorName,s=0===a.remainingPasses?a.colorName:Ue(o.colorName,"UiColor",a.renderWindowId);return o.colorName=s,w(!!a.settings.fsr.material),this._addFsrPass(e,t,a,a.settings,a.settings.fsr.material,a.renderWindowId,a.width,a.height,r,a.nativeWidth,a.nativeHeight,s)},t._addFsrPass=function(e,t,a,i,o,n,r,s,l,d,h,p){this._fsrTexSize.x=r,this._fsrTexSize.y=s,this._fsrTexSize.z=d,this._fsrTexSize.w=h,this._fsrParams.x=C(1-i.fsr.sharpness,.02,.98);var c=Ue(p,"UiColor",n),u=e.addRenderPass(d,h,"cc-fsr-easu");u.addRenderTarget(c,Ce.CLEAR,xe.STORE,ke),u.addTexture(l,"outputResultMap"),u.setVec4("fsrTexSize",this._fsrTexSize),u.addQueue(b.QueueHint.OPAQUE).addFullscreenQuad(o,0);var g=e.addRenderPass(d,h,"cc-fsr-rcas");return g.addRenderTarget(p,Ce.CLEAR,xe.STORE,ke),g.addTexture(c,"outputResultMap"),g.setVec4("fsrTexSize",this._fsrTexSize),g.setVec4("fsrParams",this._fsrParams),g.addQueue(b.QueueHint.OPAQUE).addFullscreenQuad(o,1),g},e}(),Je=function(){function e(){}var t=e.prototype;return t.getConfigOrder=function(){return 0},t.getRenderOrder=function(){return 1e3},t.setup=function(e,t,a,i,o,n){w(!!n);var r=b.SceneFlags.UI;return a.enableProfiler&&(r|=b.SceneFlags.PROFILER,n.showStatistics=!0),n.addQueue(b.QueueHint.BLEND,"default","default").addScene(i,r),n},e}();if(b){var $e=b.QueueHint,et=b.SceneFlags,tt=function(){function e(){this._pipelineEvent=r.director.root.pipelineEvent,this._forwardPass=new je,this._bloomPass=new Xe,this._toneMappingPass=new Ye,this._fxaaPass=new qe,this._fsrPass=new Ze,this._uiPass=new Je,this._clearColor=new Te(0,0,0,1),this._viewport=new De,this._configs=new Qe,this._cameraConfigs=new Ie,this._copyAndTonemapMaterial=new g,this._initialized=!1,this._passBuilders=[]}var t=e.prototype;return t._setupPipelinePreview=function(e,t){if(e.cameraUsage===Le.SCENE_VIEW||e.cameraUsage===Le.PREVIEW){var a=b.getEditorPipelineSettings();t.settings=a||He}else e.pipelineSettings?t.settings=e.pipelineSettings:t.settings=He},t._preparePipelinePasses=function(e){var t=this._passBuilders;t.length=0;var a=e.settings;if(a._passes){for(var i,o=n(a._passes);!(i=o()).done;){var r=i.value;t.push(r)}w(t.length===a._passes.length)}t.push(this._forwardPass),a.bloom.enabled&&t.push(this._bloomPass),t.push(this._toneMappingPass),a.fxaa.enabled&&t.push(this._fxaaPass),a.fsr.enabled&&t.push(this._fsrPass),t.push(this._uiPass)},t._setupBuiltinCameraConfigs=function(e,t,a,i){var o=t.window,n=t.cameraUsage===Le.GAME&&!!o.swapchain,r=n||t.cameraUsage===Le.GAME_VIEW;i.isMainGameWindow=n,i.renderWindowId=o.renderWindowId,i.colorName=o.colorName,i.depthStencilName=o.depthStencilName,i.enableFullPipeline=0!=(t.visibility&P.Enum.DEFAULT),i.enableProfiler=e.profiler&&r,i.remainingPasses=0,i.shadingScale=i.settings.shadingScale,i.enableShadingScale=i.settings.enableShadingScale&&1!==i.shadingScale,i.nativeWidth=Math.max(Math.floor(o.width),1),i.nativeHeight=Math.max(Math.floor(o.height),1),i.width=i.enableShadingScale?Math.max(Math.floor(i.nativeWidth*i.shadingScale),1):i.nativeWidth,i.height=i.enableShadingScale?Math.max(Math.floor(i.nativeHeight*i.shadingScale),1):i.nativeHeight,i.enableHDR=i.enableFullPipeline&&a.useFloatOutput,i.radianceFormat=i.enableHDR?s.Format.RGBA16F:s.Format.RGBA8,i.copyAndTonemapMaterial=this._copyAndTonemapMaterial,i.enableStoreSceneDepth=!1},t._setupCameraConfigs=function(e,t,a,i){this._setupPipelinePreview(t,i),this._preparePipelinePasses(i),this._passBuilders.sort((function(e,t){return e.getConfigOrder()-t.getConfigOrder()})),this._setupBuiltinCameraConfigs(e,t,a,i);for(var o,r=n(this._passBuilders);!(o=r()).done;){var s=o.value;s.configCamera&&s.configCamera(t,a,i)}},t.windowResize=function(e,t,a,i,o){ze(e,this._configs),this._setupCameraConfigs(e,a,this._configs,this._cameraConfigs);var r=t.renderWindowId;e.addRenderWindow(this._cameraConfigs.colorName,Re.RGBA8,i,o,t,this._cameraConfigs.depthStencilName);var s=this._cameraConfigs.width,l=this._cameraConfigs.height;this._cameraConfigs.enableShadingScale?(e.addDepthStencil("ScaledSceneDepth_"+r,Re.DEPTH_STENCIL,s,l),e.addRenderTarget("ScaledRadiance0_"+r,this._cameraConfigs.radianceFormat,s,l),e.addRenderTarget("ScaledRadiance1_"+r,this._cameraConfigs.radianceFormat,s,l),e.addRenderTarget("ScaledLdrColor0_"+r,Re.RGBA8,s,l),e.addRenderTarget("ScaledLdrColor1_"+r,Re.RGBA8,s,l)):(e.addDepthStencil("SceneDepth_"+r,Re.DEPTH_STENCIL,s,l),e.addRenderTarget("Radiance0_"+r,this._cameraConfigs.radianceFormat,s,l),e.addRenderTarget("Radiance1_"+r,this._cameraConfigs.radianceFormat,s,l),e.addRenderTarget("LdrColor0_"+r,Re.RGBA8,s,l),e.addRenderTarget("LdrColor1_"+r,Re.RGBA8,s,l)),e.addRenderTarget("UiColor0_"+r,Re.RGBA8,i,o),e.addRenderTarget("UiColor1_"+r,Re.RGBA8,i,o);for(var d,h=n(this._passBuilders);!(d=h()).done;){var p=d.value;p.windowResize&&p.windowResize(e,this._configs,this._cameraConfigs,t,a,i,o)}},t.setup=function(e,t){if(!this._initMaterials(t))for(var a,i=n(e);!(a=i()).done;){var o=a.value;o.scene&&o.window&&(this._setupCameraConfigs(t,o,this._configs,this._cameraConfigs),this._pipelineEvent.emit(M.RENDER_CAMERA_BEGIN,o),this._cameraConfigs.enableFullPipeline?this._buildForwardPipeline(t,o,o.scene,this._passBuilders):this._buildSimplePipeline(t,o),this._pipelineEvent.emit(M.RENDER_CAMERA_END,o))}},t._buildSimplePipeline=function(e,t){var a=Math.max(Math.floor(t.window.width),1),i=Math.max(Math.floor(t.window.height),1),o=this._cameraConfigs.colorName,n=this._cameraConfigs.depthStencilName,r=t.viewport;this._viewport.left=Math.round(r.x*a),this._viewport.top=Math.round(r.y*i),this._viewport.width=Math.max(Math.round(r.width*a),1),this._viewport.height=Math.max(Math.round(r.height*i),1);var s=t.clearColor;this._clearColor.x=s.x,this._clearColor.y=s.y,this._clearColor.z=s.z,this._clearColor.w=s.w;var l=e.addRenderPass(a,i,"default");Ge(t)?l.addRenderTarget(o,Ce.CLEAR,xe.STORE,this._clearColor):l.addRenderTarget(o,Ce.LOAD,xe.STORE),t.clearFlag&ve.DEPTH_STENCIL?l.addDepthStencil(n,Ce.CLEAR,xe.DISCARD,t.clearDepth,t.clearStencil,t.clearFlag&ve.DEPTH_STENCIL):l.addDepthStencil(n,Ce.LOAD,xe.DISCARD),l.setViewport(this._viewport),l.addQueue($e.OPAQUE).addScene(t,et.OPAQUE);var d=et.BLEND|et.UI;this._cameraConfigs.enableProfiler&&(d|=et.PROFILER,l.showStatistics=!0),l.addQueue($e.BLEND).addScene(t,d)},t._buildForwardPipeline=function(e,t,a,i){!function(e){e.sort((function(e,t){return e.getRenderOrder()-t.getRenderOrder()}))}(i);for(var o,r={colorName:"",depthStencilName:""},s=void 0,l=n(i);!(o=l()).done;){var d=o.value;d.setup&&(s=d.setup(e,this._configs,this._cameraConfigs,t,r,s))}w(0===this._cameraConfigs.remainingPasses)},t._initMaterials=function(e){return this._initialized?0:(ze(e,this._configs),this._copyAndTonemapMaterial._uuid="builtin-pipeline-tone-mapping-material",this._copyAndTonemapMaterial.initialize({effectName:"pipeline/post-process/tone-mapping"}),this._copyAndTonemapMaterial.effectAsset&&(this._initialized=!0),this._initialized?0:1)},e}();b.setCustomPipeline("Builtin",new tt)}r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/internal', 'chunks:///internal.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});